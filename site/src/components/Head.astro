---
import { ViewTransitions } from "astro:transitions";
import { SITE_NAME } from "@/constants/index";
import { SEO } from "astro-seo";

interface Props {
	title: string;
	description: string;
	og?:
		| {
				type?: string;
				image?: string;
		  }
		| undefined;
}

const { title, description, og } = Astro.props;
---

<head>
    <SEO
        title={title}
        description={description}
        charset='UTF-8'
        openGraph={{
            basic: {
                title,
                type: og?.type || 'website',
                image: og?.image || `${Astro.site}images/default_ogp.png`
            },
            optional: {
                description,
                siteName: SITE_NAME
            },
            image: {
                type: 'image/png',
                width: 700,
                height: 700,
                alt: SITE_NAME
            }
        }}
        twitter={{
            card: 'summary',
            creator: '@ktym4a_s',
            site: '@ktym4a_s'
        }}
        extend={{
            link: [
                { rel: 'icon', href: '/favicon.ico', type: 'image/x-icon' },
                {
                    rel: 'sitemap',
                    href: '/sitemap-index.xml'
                }
            ],
            meta: [
                {
                    name: 'viewport',
                    content: 'width=device-width, initial-scale=1.0'
                },
                {
                    name: 'generator',
                    content: Astro.generator
                }
            ]
        }}
    />
    <ViewTransitions fallback='swap' />

    <style is:global>
        @font-face {
            src: url(/fonts/0-normal.woff2) format('woff2');
            font-family: ml;
            font-weight: 100 900;
            font-style: normal;
            unicode-range: U+0020-007F;
            font-display: swap;
        }

        @font-face {
            src: url(/fonts/1-italic.woff2) format('woff2');
            font-family: ml;
            font-weight: 100 900;
            font-style: italic;
            unicode-range: U+0020-007F;
            font-display: swap;
        }

        @font-face {
            src: url(/fonts/2-normal.woff2) format('woff2');
            font-family: ml;
            font-weight: 100 900;
            font-style: normal;
            unicode-range: U+2000-206F;
            font-display: swap;
        }

        @font-face {
            src: url(/fonts/3-italic.woff2) format('woff2');
            font-family: ml;
            font-weight: 100 900;
            font-style: italic;
            unicode-range: U+2000-206F;
            font-display: swap;
        }

        @font-face {
            src: url(/fonts/4-normal.woff2) format('woff2');
            font-family: ml;
            font-weight: 100 900;
            font-style: normal;
            unicode-range: U+2070-209F;
            font-display: swap;
        }

        @font-face {
            src: url(/fonts/5-italic.woff2) format('woff2');
            font-family: ml;
            font-weight: 100 900;
            font-style: italic;
            unicode-range: U+2070-209F;
            font-display: swap;
        }

        @font-face {
            src: url(/fonts/6-normal.woff2) format('woff2');
            font-family: ml;
            font-weight: 100 900;
            font-style: normal;
            unicode-range: U+3000-303F;
            font-display: swap;
        }

        @font-face {
            src: url(/fonts/7-italic.woff2) format('woff2');
            font-family: ml;
            font-weight: 100 900;
            font-style: italic;
            unicode-range: U+3000-303F;
            font-display: swap;
        }

        @font-face {
            src: url(/fonts/8-normal.woff2) format('woff2');
            font-family: ml;
            font-weight: 100 900;
            font-style: normal;
            unicode-range: U+2600-26FF;
            font-display: swap;
        }

        @font-face {
            src: url(/fonts/9-italic.woff2) format('woff2');
            font-family: ml;
            font-weight: 100 900;
            font-style: italic;
            unicode-range: U+2600-26FF;
            font-display: swap;
        }

        @font-face {
            src: url(/fonts/10-normal.woff2) format('woff2');
            font-family: ml;
            font-weight: 100 900;
            font-style: normal;
            unicode-range: U+2700-27BF;
            font-display: swap;
        }

        @font-face {
            src: url(/fonts/11-italic.woff2) format('woff2');
            font-family: ml;
            font-weight: 100 900;
            font-style: italic;
            unicode-range: U+2700-27BF;
            font-display: swap;
        }

        @font-face {
            src: url(/fonts/12-normal.woff2) format('woff2');
            font-family: ml;
            font-weight: 100 900;
            font-style: normal;
            unicode-range: U+2300-23FF;
            font-display: swap;
        }

        @font-face {
            src: url(/fonts/13-italic.woff2) format('woff2');
            font-family: ml;
            font-weight: 100 900;
            font-style: italic;
            unicode-range: U+2300-23FF;
            font-display: swap;
        }

        @font-face {
            src: url(/fonts/14-normal.woff2) format('woff2');
            font-family: ml;
            font-weight: 100 900;
            font-style: normal;
            unicode-range: U+2190-21FF;
            font-display: swap;
        }

        @font-face {
            src: url(/fonts/15-italic.woff2) format('woff2');
            font-family: ml;
            font-weight: 100 900;
            font-style: italic;
            unicode-range: U+2190-21FF;
            font-display: swap;
        }

        @font-face {
            src: url(/fonts/16-normal.woff2) format('woff2');
            font-family: ml;
            font-weight: 100 900;
            font-style: normal;
            unicode-range: U+2B00-2BFF;
            font-display: swap;
        }

        @font-face {
            src: url(/fonts/17-italic.woff2) format('woff2');
            font-family: ml;
            font-weight: 100 900;
            font-style: italic;
            unicode-range: U+2B00-2BFF;
            font-display: swap;
        }

        @font-face {
            src: url(/fonts/18-normal.woff2) format('woff2');
            font-family: ml;
            font-weight: 100 900;
            font-style: normal;
            unicode-range: U+2200-22FF;
            font-display: swap;
        }

        @font-face {
            src: url(/fonts/19-italic.woff2) format('woff2');
            font-family: ml;
            font-weight: 100 900;
            font-style: italic;
            unicode-range: U+2200-22FF;
            font-display: swap;
        }

        @font-face {
            src: url(/fonts/20-normal.woff2) format('woff2');
            font-family: ml;
            font-weight: 100 900;
            font-style: normal;
            unicode-range: U+2580-259F;
            font-display: swap;
        }

        @font-face {
            src: url(/fonts/21-italic.woff2) format('woff2');
            font-family: ml;
            font-weight: 100 900;
            font-style: italic;
            unicode-range: U+2580-259F;
            font-display: swap;
        }

        @font-face {
            src: url(/fonts/22-normal.woff2) format('woff2');
            font-family: ml;
            font-weight: 100 900;
            font-style: normal;
            unicode-range: U+0300-036F;
            font-display: swap;
        }

        @font-face {
            src: url(/fonts/23-italic.woff2) format('woff2');
            font-family: ml;
            font-weight: 100 900;
            font-style: italic;
            unicode-range: U+0300-036F;
            font-display: swap;
        }

        @font-face {
            src: url(/fonts/24-normal.woff2) format('woff2');
            font-family: ml;
            font-weight: 100 900;
            font-style: normal;
            unicode-range: U+02B0-02FF;
            font-display: swap;
        }

        @font-face {
            src: url(/fonts/25-italic.woff2) format('woff2');
            font-family: ml;
            font-weight: 100 900;
            font-style: italic;
            unicode-range: U+02B0-02FF;
            font-display: swap;
        }

        @keyframes slide {
            0% {
                transform: translateX(100%);
                opacity: 0;
            }
            100% {
                transform: translateX(0%);
                opacity: 1;
            }
        }
        @keyframes slideBack {
            0% {
                transform: translateX(0%);
                opacity: 1;
            }
            100% {
                transform: translateX(100%);
                opacity: 0;
            }
        }
    </style>

    <script is:inline>
        const setTtheme = (document) => {
            const element = document.documentElement
            element.classList.remove('ctp-latte', 'ctp-mocha')

            let theme = 'ctp-latte'

            if (
                typeof localStorage !== 'undefined' &&
                localStorage.getItem('theme')
            ) {
                theme = localStorage.getItem('theme')
            } else {
                if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
                    theme = 'ctp-mocha'
                }
            }
            document.documentElement.classList.add(theme)

            window.localStorage.setItem('theme', theme)
        }

        setTtheme(document)

        document.addEventListener('astro:before-swap', (ev) => {
            setTtheme(ev.newDocument)
        })

        document.addEventListener('astro:page-load', () => {
            const headings = document.querySelectorAll(
                'main h1, main h2, main h3'
            )
            const observer = new IntersectionObserver(
                (entries) => {
                    entries.forEach((entry) => {
                        const id = entry.target.id
                        const tocItem = document.getElementById(`toc_${id}`)
                        if (tocItem) {
                            if (entry.isIntersecting) {
                                tocItem.classList.add('current')
                            } else {
                                tocItem.classList.remove('current')
                            }
                        }
                    })
                },
                {
                    root: document.getElementById('main')
                }
            )
            headings.forEach((heading) => {
                observer.observe(heading)
            })
        })

        document.addEventListener('astro:page-load', () => {
            document.getElementById('navOpen').addEventListener('click', () => {
                document.querySelector('#navOpen').classList.toggle('current')
                document
                    .querySelector('#nav')
                    .classList.toggle('translate-x-full')
            })
        })

        const handleToggleClick = () => {
            const element = document.documentElement
            if (element.classList.contains('ctp-latte')) {
                element.classList.remove('ctp-latte')
                element.classList.add('ctp-mocha')
                localStorage.setItem('theme', 'ctp-mocha')
            } else {
                element.classList.remove('ctp-mocha')
                element.classList.add('ctp-latte')
                localStorage.setItem('theme', 'ctp-latte')
            }
        }

        document.addEventListener('astro:page-load', () => {
            document
                .getElementById('themeToggle')
                .addEventListener('click', handleToggleClick)
        })
    </script>
</head>
